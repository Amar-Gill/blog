---
layout: "@/layouts/BlogPost"
title: Setting Up Neovim For Astro Development
publishDate: January 6, 2023
description: The settings and plugins I use to build Astro websites.
tags: ["astro", "neovim"]
draft: false
---
#### TLDR
- The `astro` [language server](https://github.com/withastro/language-tools/tree/main/packages/language-server) can be installed with [mason](https://github.com/williamboman/mason.nvim) and set up through the [nvim-lsp-config](https://github.com/neovim/nvim-lspconfig/blob/master/doc/server_configurations.md#astro) plugin 
- For syntax highlighting of `.astro` files, the [tree-sitter-astro](https://github.com/virchau13/tree-sitter-astro) grammar is available through the [nvim-treesitter](https://github.com/nvim-treesitter/nvim-treesitter#supported-languages) plugin
- [jxnblk/vim-mdx-js](https://github.com/jxnblk/vim-mdx-js) plugin for syntax highlighting of `.mdx` files
- I use the document formatter provided by the Astro language server, and *not* the [prettierd](https://github.com/fsouza/prettierd) built in formatting source via [null-ls](https://github.com/jose-elias-alvarez/null-ls.nvim/blob/main/doc/BUILTINS.md#prettierd). [Why](#formatting)?
- Look into the `wrap` and `sidescroll` options to control how you want to work with lines that trail off the screen

#### Basics
To get started we need LSP support and syntax highlighting for `.astro` files. Neovim supports this through the [nvim-lsp-config](https://github.com/neovim/nvim-lspconfig/blob/master/doc/server_configurations.md#astro) and [nvim-treesitter](https://github.com/nvim-treesitter/nvim-treesitter#supported-languages) plugins.

#### MDX Syntax Highlighting
I noticed `.mdx` files were not being highlighted at all, despite having the tree-sitter grammar for [markdown](https://github.com/MDeiml/tree-sitter-markdown) installed. I couldn't find a tree-sitter grammar for `.mdx` files, but there was a neovim plugin that I could install instead: [jxnblk/vim-mdx-js](https://github.com/jxnblk/vim-mdx-js).

I'm really happy with this plugin so far. It provides syntax highlighting of frontmatter which is in `.yaml` format. And it correctly highlights code blocks for all the programming languages I write about.

#### Formatting
Consistent and fast formatting is non-negotiable for me. Being a JavaScript framework, many of the [astro themes](https://astro.build/themes/) I looked at had [prettier](https://prettier.io/) and [eslint](https://eslint.org/) configured. Great! My configuration works with React so Astro should not be too different.

After testing it out on a project, I noticed the formatter was not working. Running the `:LspInfo` nvim command revealed that the `null-ls` server was not attached to the buffer.

Looking at the [prettierd](https://github.com/jose-elias-alvarez/null-ls.nvim/blob/main/doc/BUILTINS.md#prettierd) default arguments, the `.astro` filetype was not included. So I added it as an [extra_filetype](https://github.com/jose-elias-alvarez/null-ls.nvim/blob/main/doc/BUILTIN_CONFIG.md#filetypes):

```lua
local null_ls = require("null-ls")
local formatting = null_ls.builtins.formatting

local sources = {
  formatting.prettierd.with({
    extra_filetypes = { "astro" },
  }),
}
```

Now I was able to get the `null-ls` server attached to the `astro` buffer, but the formatter was still not working.

I then looked into the [Astro VS Code Extension](https://marketplace.visualstudio.com/items?itemName=astro-build.astro-vscode) which is officially maintained by the Astro team. I learned that the formatting is included in the language server itself.

So instead I need to update my LSP formatting handler to use both the `null-ls` and `astro` language servers. Until now it had only been `null-ls`:

```lua
local lsp_formatting = function(bufnr)
  vim.lsp.buf.format({
    filter = function(client)
      local name = client.name
      return name == "null-ls" or name == "astro"
    end,
    bufnr = bufnr,
  })
end
```

#### Editing Markdown in Neovim
Markdown files usually contain long lines that will trail off the screen if you don't enable text wrapping. If you want to keep text wrapping off, you can modify the `sidescroll` option. It controls the minimum number of columns to scroll horizontally when the `wrap` option is off and the cursor moves off the screen.

The default amount is 1. You can try setting it to 5 which will move the cursor back by 5 columns as you write. Setting the option to 0 will move the cursor to the middle which you may prefer instead:

```lua
vim.opt.wrap = false
vim.opt.sidescroll = 0 | 1 | 5
```
